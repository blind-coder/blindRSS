<html>
<head>
<title>blindRSS</title>
<link rel='stylesheet' href='style.css'>
<script type="text/javascript">
var optionarray;
var startupprocedure = 0;
var feedarray = new Array();
/*
 * feedarray
 * array = (ID, name, startID, endID, url, array = (title, array=(line), link, itemid, isread))
 */
var options = new Array();
var request;
var Width = window.innerWidth;
var Height = window.innerHeight;
var rollUpHeightOriginals = new Array();
var mouseX;
var mouseY;

function getMouseCoordinates(event) {{{
	var ev = event || window.event;
	mouseX = ev.pageX;
	mouseY = ev.pageY;
}}}
function resize(){{{
	Width = window.innerWidth;
	Height = window.innerHeight;
	if (document.getElementById("subnavigationscrollouter")){
		document.getElementById("subnavigationscrollouter").style.height=Height-145+"px";
		document.getElementById("contentinner").style.height=Height-280+"px";
	}
}}}
function getContainersByIndex(feedIndex){{{
	var retVal = new Array();
	for (var i=0; i<feedarray.length; i++){
		if (feedarray[i][2] < feedarray[feedIndex][2] && feedarray[feedIndex][3] < feedarray[i][3]){
			retVal[retVal.length] = i;
		}
	}
	return retVal;
}}}
function getContainersByID(feedID){{{
	var feedIndex = -1;
	var retVal = new Array();
	for (var i=0; i<feedarray.length; i++){
		if (feedarray[i][0] ==  feedID){
			feedIndex = i;
			break;
		}
	}
	if (feedIndex == -1){
		return retVal;
	}
	for (var i=0; i<feedarray.length; i++){
		if (feedarray[i][2] < feedarray[feedIndex][2] && feedarray[feedIndex][3] < feedarray[i][3]){
			retVal[retVal.length] = i;
		}
	}
	return retVal;
}}}
function getContainedByIndex(feedIndex){{{
	var retVal = new Array();
	for (var i=0; i<feedarray.length; i++){
		if (feedarray[i][2] > feedarray[feedIndex][2] && feedarray[feedIndex][3] > feedarray[i][3]){
			retVal[retVal.length] = i;
		}
	}
	return retVal;
}}}
function getContainedByID(feedID){{{
	var feedIndex = -1;
	var retVal = new Array();
	for (var i=0; i<feedarray.length; i++){
		if (feedarray[i][0] ==  feedID){
			feedIndex = i;
			break;
		}
	}
	if (feedIndex == -1){
		return retVal;
	}
	for (var i=0; i<feedarray.length; i++){
		if (feedarray[i][2] > feedarray[feedIndex][2] && feedarray[feedIndex][3] > feedarray[i][3]){
			retVal[retVal.length] = i;
		}
	}
	return retVal;
}}}
function rollUp(x){{{
	var a = document.getElementById("arollUp"+x);
	var div = document.getElementById("divrollUp"+x);
	var img = document.getElementById("imgrollUp"+x);
	rollUpHeightOriginals[x] = div.clientHeight;
	div.style.visibility="collapse";
	div.style.height=0;
	a.href="javascript:rollDown('"+x+"');";
	img.src="go-previous.png";
}}}
function rollDown(x){{{
	var a = document.getElementById("arollUp"+x);
	var div = document.getElementById("divrollUp"+x);
	var img = document.getElementById("imgrollUp"+x);
	div.style.visibility="";
	div.style.height=rollUpHeightOriginals[x];
	a.href="javascript:rollUp('"+x+"');";
	img.src="go-down.png";
}}}
function showHierarchyInSelect(container, selectedID){{{
	var parents = new Array();
	parents[0] = new Array();
	parents[0][0] = container;
	parents[0][1] = 0;
	for (var i=0; i<feedarray.length; i++){
/* array = (ID, name, startID, endID, url, array = (title, array=(line), link, itemid, isread)) */
		if (i > 0){
			for (var x=0; x < feedarray[i][2] - feedarray[i-1][3] - 1; x++){
				var option;
				option = document.createElement("option");
				option.value = parents[parents.length-1][1];
				option.text = "(End of "+parents[parents.length-1][2]+")";
				if (selectedID == option.value){
					option.selected = true;
				}
				parents[parents.length-1][0].appendChild(option);
				parents.pop();
			}
			if (feedarray[i][2] == feedarray[i-1][3] + 1 && (feedarray[i-1][4] == "NULL" || feedarray[i-1][4] == "")){
				var option;
				option = document.createElement("option");
				option.value = parents[parents.length-1][1];
				option.text = "(End of "+parents[parents.length-1][2]+")";
				if (selectedID == option.value){
					option.selected = true;
				}
				parents[parents.length-1][0].appendChild(option);
				parents.pop();
			}
		}
		if (feedarray[i][4] == "NULL" || feedarray[i][4] == ""){
			var optgroup = document.createElement("optgroup");
			optgroup.label = feedarray[i][1];
			parents[parents.length-1][0].appendChild(optgroup);
			parents[parents.length] = new Array();
			parents[parents.length-1][0]=optgroup;
			parents[parents.length-1][1]=feedarray[i][0];
			parents[parents.length-1][2]=feedarray[i][1];
			continue;
		}
		var option;
		option = document.createElement("option");
		option.value = feedarray[i][0];
		option.text = feedarray[i][1];
		if (selectedID == option.value){
			option.selected = true;
		}
		parents[parents.length-1][0].appendChild(option);
	}
}}}
function submitFeedChanges(x){{{
	var feedTitle = document.getElementById("inputFeedTitle").value;
	var feedURL;
	var moveAbove = document.getElementById("selMoveAbove").value;

	if (document.getElementById("inputFeedURL"))
		feedURL = document.getElementById("inputFeedURL").value;
	else
		feedURL = "";
	if (confirm("Make these changes to the feed?")){
		request=ajaxManager();

		request.open("GET", "editfeed.php?feedid="+x+"&newtitle="+feedTitle+"&newurl="+feedURL+"&moveabove="+moveAbove, true);
		request.onreadystatechange = processAddDelEditFeed;
		showstatus("Changing feed");
		request.send(null);
	}

}}}
function closeSettings(){{{
	document.getElementById("divSettings").style.visibility='hidden';
}}}
function showSettings(feedID){{{
	var divSettings = document.getElementById("divSettings");
	var divSettingsInner = document.getElementById("divSettingsInner");
	var feed = feedarray[feedID];

	while (divSettingsInner.lastChild){
		divSettingsInner.removeChild(divSettingsInner.lastChild);
	}

	var table = document.createElement("table");
	var tbody = document.createElement("tbody");
	var tr = document.createElement("tr");
	var td = document.createElement("td");

	td.appendChild(document.createTextNode(feed[1]));
	tr.appendChild(td);
	td = document.createElement("td");
	td.align="right";
	var a = document.createElement("a");
	a.href="javascript:closeSettings();";
	var img = document.createElement("img");
	img.src = "process-stop.png";
	img.border = 0;
	a.appendChild(img);
	td.appendChild(a);
	tr.appendChild(td);
	tbody.appendChild(tr);

	tr = document.createElement("tr");
	td = document.createElement("td");
	td.appendChild(document.createTextNode("Move above feed: "));
	tr.appendChild(td);
	td = document.createElement("td");
	var select = document.createElement("select");
	select.id = "selMoveAbove";
	select.size = 5;
	showHierarchyInSelect(select, feed[0]);

	td.appendChild(select);
	tr.appendChild(td);
	tbody.appendChild(tr);

 /* array = (ID, name, startID, endID, url, array = (title, array=(line), link, itemid, isread))*/

	tr = document.createElement("tr");
	td = document.createElement("td");
	td.appendChild(document.createTextNode("Feedtitle: "));
	tr.appendChild(td);
	td = document.createElement("td");
	var input = document.createElement("input");
	input.id = "inputFeedTitle";
	input.value = feed[1];
	td.appendChild(input);
	tr.appendChild(td);
	tbody.appendChild(tr);

	tr = document.createElement("tr");
	td = document.createElement("td");
	td.appendChild(document.createTextNode("FeedURL: "));
	tr.appendChild(td);
	td = document.createElement("td");
	var input = document.createElement("input");
	input.id = "inputFeedURL";
	input.value = feed[4];
	td.appendChild(input);
	tr.appendChild(td);
	tbody.appendChild(tr);

	tr = document.createElement("tr");
	td = document.createElement("td");
	tr.appendChild(td);
	td = document.createElement("td");
	var a = document.createElement("a");
	a.href="javascript:submitFeedChanges("+feedarray[feedID][0]+");";
	a.appendChild(document.createTextNode("Submit Changes"));
	td.appendChild(a);
	tr.appendChild(td);
	tbody.appendChild(tr);

	table.appendChild(tbody);
	divSettingsInner.appendChild(table);
	divSettings.style.left = mouseX-5;
	if (mouseY + divSettings.offsetHeight > Height){
		divSettings.style.top = Height - divSettings.offsetHeight - 5;
	} else {
		divSettings.style.top = mouseY-5;
	}
	divSettings.style.zIndex=9999;
	divSettings.style.visibility="";
}}}
function showSettingsDirectory(feedID){{{
	var divSettings = document.getElementById("divSettings");
	var divSettingsInner = document.getElementById("divSettingsInner");
	var feed = feedarray[feedID];

	while (divSettingsInner.lastChild){
		divSettingsInner.removeChild(divSettingsInner.lastChild);
	}

	var table = document.createElement("table");
	var tbody = document.createElement("tbody");
	var tr = document.createElement("tr");
	var td = document.createElement("td");

	td.appendChild(document.createTextNode(feed[1]));
	tr.appendChild(td);
	td = document.createElement("td");
	td.align="right";
	var a = document.createElement("a");
	a.href="javascript:closeSettings();";
	var img = document.createElement("img");
	img.src = "process-stop.png";
	img.border = 0;
	a.appendChild(img);
	td.appendChild(a);
	tr.appendChild(td);
	tbody.appendChild(tr);

	tr = document.createElement("tr");
	td = document.createElement("td");
	td.appendChild(document.createTextNode("Move above feed: "));
	tr.appendChild(td);
	td = document.createElement("td");
	var select = document.createElement("select");
	select.id = "selMoveAbove";
	select.size = 5;
	showHierarchyInSelect(select, feed[0]);

	td.appendChild(select);
	tr.appendChild(td);
	tbody.appendChild(tr);

	tr = document.createElement("tr");
	td = document.createElement("td");
	td.appendChild(document.createTextNode("Directoryname: "));
	tr.appendChild(td);
	td = document.createElement("td");
	var input = document.createElement("input");
	input.id = "inputFeedTitle";
 /* array = (ID, name, startID, endID, url, array = (title, array=(line), link, itemid, isread))*/
	input.value = feed[1];
	td.appendChild(input);
	tr.appendChild(td);
	tbody.appendChild(tr);

	tr = document.createElement("tr");
	td = document.createElement("td");
	tr.appendChild(td);
	td = document.createElement("td");
	var a = document.createElement("a");
	a.href="javascript:submitFeedChanges("+feed[0]+");";
	a.appendChild(document.createTextNode("Submit Changes"));
	td.appendChild(a);
	tr.appendChild(td);
	tbody.appendChild(tr);

	table.appendChild(tbody);
	divSettingsInner.appendChild(table);
	divSettings.style.left = mouseX-5;
	if (mouseY + divSettings.offsetHeight > Height){
		divSettings.style.top = Height - divSettings.offsetHeight - 5;
	} else {
		divSettings.style.top = mouseY-5;
	}
	divSettings.style.zIndex=9999;
	divSettings.style.visibility="";
}}}
function showstatus(stat){{{
// Changes the text of the status line at the top to 'stat'
	var statline=document.getElementById("statusline");

	statline.firstChild.nodeValue="Status: " + stat;
}}}
function ajaxManager() {{{
// returns an XMLHttpRequest Object
	var r;
	if (document.getElementById) {
		if (window.XMLHttpRequest) {
			r=new XMLHttpRequest();
		}
	}
	if (r){
		return r;
	} else {
		alert ("Too cool for IE!");
	}
}}}
function processMarkRead() {{{
// Processes Requests for marking a feed entry as 'read'
	if (request.readyState == 4) {
		if (request.status != 200){
			showstatus("Error marking entry as 'read': " + request.status + " " + request.statusText);
		}
	}
}}}
function hideDirectoryNewMessages(feedIndex){{{
	var containers = getContainersByIndex(feedIndex);
	for (var x=0; x<containers.length; x++){
		var contained = getContainedByIndex(containers[x]);
		var attr = "hidden";
		for (var y=0; y<contained.length; y++){
			for (var z=0; z<feedarray[contained[y]][5].length; z++){
/* array = (ID, name, startID, endID, url, array = (title, array=(line), link, itemid, isread)) */
				if (feedarray[contained[y]][5][z][4] == 0){
					attr = "";
					break;
				}
			}
			document.getElementById("divNewMessages"+containers[x]).style.visibility=attr;
		}
	}
}}}
function markReadAllDirectory(feedid) {{{
// Processes Requests for marking a whole directory as 'read'
	if (confirm("Mark all entries in this directory as 'read'?")){
		var contained = getContainedByIndex(feedid);
		for (var x=0; x<contained.length; x++){
			markReadAll(contained[x], true);
		}
	}
}}}
function markReadAll(feedid, force) {{{
// Processes Requests for marking a whole feed as 'read'
	if (!force){
		if (!confirm("Mark all entries as 'read'?")){
			return false;
		}
	}
	request=ajaxManager();

	request.open("GET", "markreadall.php?feedid=" + feedarray[feedid][0], true);
	request.onreadystatechange = processMarkRead;
	showstatus("Marking all entries as 'read'");
	request.send(null);
	for (itemid = 0; itemid < feedarray[feedid][5].length; itemid++){
		feedarray[feedid][5][itemid][4] = 1;
	}
	showItems(feedid);
	document.getElementById("divNewMessages"+feedid).style.visibility="hidden";
	hideDirectoryNewMessages(feedid);
}}}
function showDetails(feedid, itemid){{{
// displays the details of a feed entry in the main display area and marks the entry as 'read'
	var contentheadline=document.getElementById("contentheadline");
	var contentcontent=document.getElementById("contentcontent");

	contentheadline.firstChild.nodeValue=feedarray[feedid][5][itemid][0];
	contentheadline.href=feedarray[feedid][5][itemid][2];
	var txt;
	for (var i=0; i<feedarray[feedid][5][itemid][1].length; i++){
		if (txt){
			txt = txt + feedarray[feedid][5][itemid][1][i] + "<br>";
		} else {
			txt = feedarray[feedid][5][itemid][1][i] + "<br>";
		}
	}

	contentcontent.innerHTML=txt;
	request=ajaxManager();

	request.open("GET", "markread.php?itemid="+feedarray[feedid][5][itemid][3], true);
	feedarray[feedid][5][itemid][4] = 1;
	showItems(feedid);
	request.onreadystatechange = processMarkRead;
	showstatus("Marking entry as 'read'");
	request.send(null);
	var newitems = 0;
	for (var i=0; i<feedarray[feedid][5].length; i++){
		if (feedarray[feedid][5][i][4] == 0){ // not read
			newitems++;
			break;
		}
	}
	if (newitems == 0){
		document.getElementById("divNewMessages"+feedid).style.visibility="hidden";
	}
	hideDirectoryNewMessages(feedid);
}}}
function showItems(id){{{
// shows the items of a feed in the top display area
// new ones are in bold
	var feed;
	feed = feedarray[id];

	var div = document.getElementById("subnavigation");
	div.style.marginLeft = "3px";
	if (div.firstChild){
		while(div.firstChild){
			div.removeChild(div.firstChild);
		}
	}
	for (var i=0; i < feed[5].length; i++){
		var a=document.createElement("a");
		a.href="javascript:showDetails("+id+","+i+");";
		//a.appendChild(document.createTextNode(feed[5][i][0]));
		a.innerHTML=feed[5][i][0];

		if(feed[5][i][4] == 1){
			div.appendChild(a);
		} else {
			var b = document.createElement("b");
			b.appendChild(a);
			div.appendChild(b);
		}
		div.appendChild(document.createElement("br"));
	}
}}}
function processFeed() {{{
// processes the update of a single feed and hides/unhides the 'new entries' image on demand
	if (request.readyState == 4) {
		if (request.status == 200){
			showstatus("Reloading feed");
			var feed = request.responseXML.firstChild;
			var id = feed.firstChild;
			var item = id.nextSibling;
			var feedarrayptr;
			var feedarrayid;
			var feedarrayitem;
			for (var i=0; i<feedarray.length; i++){
				if (feedarray[i][0] == id.firstChild.nodeValue){
					feedarrayid=i;
					feedarrayptr=feedarray[i];
					feedarrayitem=i;
					i=feedarray.length;
				}
			}
			if (!feedarrayptr){
				showstatus("Couldn't find feed id " + id.firstChild.nodeValue);
				return;
			}
			feedarrayptr[5] = new Array();
			feedarrayptr = feedarrayptr[5];
			while(item){
				var itemid = item.firstChild;
				var title = itemid.nextSibling;
				var content = title.nextSibling;
				var link = content.nextSibling;
				var isread = link.nextSibling;

				var newitem = feedarrayptr.length;

				feedarrayptr[newitem] = new Object();
				feedarrayptr[newitem][0] = title.firstChild.nodeValue;
				feedarrayptr[newitem][1] = new Array();
				var line = content.firstChild;
				var ptr = feedarrayptr[newitem][1];
				while (line && line.firstChild){
					ptr[ptr.length] = line.firstChild.nodeValue;
					line=line.nextSibling;
				}
				if (link.firstChild){
					feedarrayptr[newitem][2] = link.firstChild.nodeValue;
				}
				if (itemid.firstChild){
					feedarrayptr[newitem][3] = itemid.firstChild.nodeValue;
				}
				if (isread.firstChild){
					feedarrayptr[newitem][4] = isread.firstChild.nodeValue;
				}

				if (isread.firstChild.nodeValue == 0){
					var div = document.getElementById("divNewMessages"+feedarrayitem);
					if (div){
						div.style.visibility="";
					}
				}
				item=item.nextSibling;
			}
			showstatus("Feed reloaded");
			hideDirectoryNewMessages(feedarrayid);
			request = null;
			showItems(feedarrayitem);
		} else {
			showstatus("Error fetching Feed: " + request.status + " " + request.statustext);
		}
	}
}}}
function processAllFeeds() {{{
// processes the update of a single feed and hides/unhides the 'new entries' image on demand
	if (request.readyState == 4) {
		if (request.status == 200){
			var feeds = request.responseXML.firstChild;
			if (!feeds.firstChild.firstChild){
				showstatus("No new messages.");
				return;
			} else {
				showstatus("Reloading all feeds");
			}
			for (var feed = feeds.firstChild; feed; feed = feed.nextSibling){
				var id = feed.firstChild;
				var item = id.nextSibling;
				var feedarrayptr;
				var feedarrayid;
				var feedarrayitem;
				for (var i=0; i<feedarray.length; i++){
					if (feedarray[i][0] == id.firstChild.nodeValue){
						feedarrayid=i;
						feedarrayptr=feedarray[i];
						feedarrayitem=i;
						i=feedarray.length;
					}
				}
				if (!feedarrayptr){
					showstatus("Couldn't find feed id " + id.firstChild.nodeValue);
					return;
				}
				feedarrayptr[5] = new Array();
				feedarrayptr = feedarrayptr[5];
				while(item){
					var itemid = item.firstChild;
					var title = itemid.nextSibling;
					var content = title.nextSibling;
					var link = content.nextSibling;
					var isread = link.nextSibling;

					var newitem = feedarrayptr.length;

					feedarrayptr[newitem] = new Object();
					feedarrayptr[newitem][0] = title.firstChild.nodeValue;
					feedarrayptr[newitem][1] = new Array();
					var line = content.firstChild;
					var ptr = feedarrayptr[newitem][1];
					while (line && line.firstChild){
						ptr[ptr.length] = line.firstChild.nodeValue;
						line=line.nextSibling;
					}
					if (link.firstChild){
						feedarrayptr[newitem][2] = link.firstChild.nodeValue;
					}
					if (itemid.firstChild){
						feedarrayptr[newitem][3] = itemid.firstChild.nodeValue;
					}
					if (isread.firstChild){
						feedarrayptr[newitem][4] = isread.firstChild.nodeValue;
					}

					if (isread.firstChild.nodeValue == 0){
						var div = document.getElementById("divNewMessages"+feedarrayitem);
						if (div){
							div.style.visibility="";
						}
					}
					item=item.nextSibling;
				}
				hideDirectoryNewMessages(feedarrayid);
				request = null;
			}
		} else {
			showstatus("Error fetching Feed: " + request.status + " " + request.statustext);
		}
		showstatus("All feeds reloaded");
	}
}}}
function reloadFeed(i){{{
// initiates the update of the entries of a single feed
	showstatus("Loading contents of '" + feedarray[i][1] + "'");
	request=ajaxManager();
	if (document.getElementById("onlyunread").checked){
		request.open("GET", "feed.php?id="+feedarray[i][0]+"&onlychecked=1", true);
	} else {
		request.open("GET", "feed.php?id="+feedarray[i][0], true);
	}
	request.onreadystatechange=processFeed;
	request.send(null);
}}}
function reloadAllFeeds(){{{
// initiates the update of the entries of all feeds
	request=ajaxManager();
	showstatus("Reloading All Feeds");
	if (document.getElementById("onlyunread").checked){
		request.open("GET", "allfeeds.php?onlychecked=1", true);
	} else {
		request.open("GET", "allfeeds.php", true);
	}
	request.onreadystatechange=processAllFeeds;
	request.send(null);
}}}
function showNavigation() {{{
	var i;
	var parents = new Array();
	parents[0] = document.getElementById("navigation");
	for (i=0; i<feedarray.length; i++){
		/* array = (ID, name, startID, endID, url, array = (title, array=(line), link, itemid, isread)) */
		if (i > 0){
			for (var x=0; x < feedarray[i][2] - feedarray[i-1][3] - 1; x++){
				parents.pop();
			}
			if (feedarray[i][2] == feedarray[i-1][3] + 1 && (feedarray[i-1][4] == "NULL" || feedarray[i-1][4] == "")){
				parents.pop();
			}
		}
		if (feedarray[i][4] == "NULL" || feedarray[i][4] == ""){{{
			var table=document.createElement("table");
			var tbody=document.createElement("tbody");
			var tr=document.createElement("tr");
			var td=document.createElement("td");
			var div=document.createElement("div");

			td.setAttribute("class", "navigationheadline");

			div.appendChild(document.createTextNode(feedarray[i][1]));
			div.style.position="relative";
			div.style.top="0px";
			div.style.left="0px";

			divdiv=document.createElement("div");

			a=document.createElement("a");
			var img=document.createElement("img");
			a.href="javascript:rollUp('"+i+"');";
			a.id="arollUp"+i;
			divdiv.style.position="absolute";
			divdiv.style.right="0px";
			divdiv.style.top="0px";
			img.title="Close";
			img.src="go-down.png";
			img.border=0;
			img.id="imgrollUp"+i;
			a.appendChild(img);
			divdiv.appendChild(a);
			div.appendChild(divdiv);

			divdiv=document.createElement("div");

			a=document.createElement("a");
			var img=document.createElement("img");
			a.href="javascript:showSettingsDirectory("+i+");";
			divdiv.style.position="absolute";
			divdiv.style.right="16px";
			divdiv.style.top="0px";
			img.title="Change Settings";
			img.src="applications-system.png";
			img.border=0;
			a.appendChild(img);
			divdiv.appendChild(a);
			div.appendChild(divdiv);

			divdiv=document.createElement("div");

			a=document.createElement("a");
			a.href="javascript:markReadAllDirectory("+i+");";
			var img=document.createElement("img");
			divdiv.style.position="absolute";
			divdiv.style.right="48px";
			divdiv.style.top="0px";
			divdiv.style.visibility="hidden";
			divdiv.id="divNewMessages"+i;
			img.title="New messages!";
			img.src="mail-message-new.png";
			img.border=0;
			a.appendChild(img);
			divdiv.appendChild(a);
			div.appendChild(divdiv);

			td.appendChild(div);
			tr.appendChild(td);
			tbody.appendChild(tr);
			table.appendChild(tbody);
			parents[parents.length-1].appendChild(table);

			div=document.createElement("div");
			div.id="divrollUp"+i;
			div.style.position="relative";
			div.style.top="0px";
			div.style.left="0px";
			var ul=document.createElement("ul");
			ul.style.paddingLeft="10px";
			ul.style.marginTop="0px";
			ul.style.marginBottom="0px";
			ul.id="subNavigation"+i;

			div.appendChild(ul);
			parents[parents.length-1].appendChild(div);
			parents[parents.length] = ul;
			continue;
		}}}
		/* array = (ID, name, startID, endID, url, array = (title, array=(line), link, itemid, isread)) */
		var table=document.createElement("table");
		var tbody=document.createElement("tbody");
		var tr=document.createElement("tr");
		var td=document.createElement("td");
		var div=document.createElement("div");
		var divdiv=document.createElement("div");

		td.setAttribute("class", "navigationheadline");
		var a = document.createElement("a");
		a.href="javascript:showItems("+i+");";
		a.appendChild(document.createTextNode(feedarray[i][1]));
		div.appendChild(a);
		div.style.position="relative";
		div.style.top="0px";
		div.style.left="0px";

		divdiv=document.createElement("div");

		a=document.createElement("a");
		var img=document.createElement("img");
		a.href="javascript:reloadFeed("+i+");";
		divdiv.style.position="absolute";
		divdiv.style.right="32px";
		divdiv.style.top="0px";
		img.title="Reload this feed";
		img.src="view-refresh.png";
		img.border=0;
		a.appendChild(img);
		divdiv.appendChild(a);
		div.appendChild(divdiv);

		divdiv=document.createElement("div");

		a=document.createElement("a");
		var img=document.createElement("img");
		a.href="javascript:showSettings("+i+");";
		divdiv.style.position="absolute";
		divdiv.style.right="16px";
		divdiv.style.top="0px";
		img.title="Change Feed";
		img.src="applications-system.png";
		img.border=0;
		a.appendChild(img);
		divdiv.appendChild(a);
		div.appendChild(divdiv);

		divdiv=document.createElement("div");

		a=document.createElement("a");
		a.href="javascript:markReadAll("+i+", false);";
		var img=document.createElement("img");
		divdiv.style.position="absolute";
		divdiv.style.right="48px";
		divdiv.style.top="0px";
		divdiv.style.visibility="hidden";
		divdiv.id="divNewMessages"+i;
		img.title="New messages!";
		img.src="mail-message-new.png";
		img.border=0;
		a.appendChild(img);
		divdiv.appendChild(a);
		div.appendChild(divdiv);

		a=document.createElement("a");
		a.href="javascript:removeFeed("+i+");";
		divdiv=document.createElement("div");
		divdiv.style.position="absolute";
		divdiv.style.right="0px";
		divdiv.style.top="0px";
		img=document.createElement("img");
		img.title="Delete this feed";
		img.src="process-stop.png";
		img.border=0;
		a.appendChild(img);
		divdiv.appendChild(a);
		div.appendChild(divdiv);
		td.appendChild(div);
		tr.appendChild(td);

		tbody.appendChild(tr);
		table.appendChild(tbody);
		table.setAttribute("id", "feed"+i);
		parents[parents.length-1].appendChild(table);
	}
}}}
function getPathToParentIDByIndex(parentIndex) {{{
	var retVal = "";
	for (var i=0; i<=parentIndex; i++){
		if (feedarray[i][2] <= feedarray[parentIndex][2] &&
		    feedarray[i][3] >= feedarray[parentIndex][3] &&
		    (feedarray[i][4] == "" || feedarray[i][4] == "NULL")){
			retVal = retVal + "/" + feedarray[i][1];
		}
	}
	return(retVal);
}}}
function processFeedList() {{{
// processes the request for updating the feed list
	if (request.readyState == 4) {
		if (request.status == 200){
			var navigation=document.getElementById("navigation");
			var feeds;
			var feed;
			var addDir = document.getElementById("addDir");
			while (addDir.lastChild){
				addDir.removeChild(addDir.lastChild);
			}
			feeds=request.responseXML.firstChild;
			feed=feeds.firstChild;
			while(feed){
				/* childNode[0]: id
				   childNode[1]: name 
				   childNode[2]: startID
				   childNode[3]: endID
				   childNode[4]: url */
				var feedarraynewelement = feedarray.length;
				var id;
				var name;
				var startID;
				var endID;
				var url;
				id=parseInt(feed.childNodes[0].firstChild.nodeValue);
				name=feed.childNodes[1].firstChild.nodeValue;
				startID=parseInt(feed.childNodes[2].firstChild.nodeValue);
				endID=parseInt(feed.childNodes[3].firstChild.nodeValue);
				url=feed.childNodes[4].firstChild.nodeValue;

				var i;
				feedarray[feedarraynewelement] = new Object();
				feedarray[feedarraynewelement][0] = id;
				feedarray[feedarraynewelement][1] = name;
				feedarray[feedarraynewelement][2] = startID;
				feedarray[feedarraynewelement][3] = endID;
				feedarray[feedarraynewelement][4] = url;
				feedarray[feedarraynewelement][5] = new Object();
				if (url == "NULL" || url == ""){
					var option=document.createElement("option");
					option.text=getPathToParentIDByIndex(feedarraynewelement);
					option.value=id;
					addDir.appendChild(option);
				}
				feed=feed.nextSibling;
			}
			showstatus(feedarray.length + " Feeds loaded");
			var navigation=document.getElementById("navigation");
			showNavigation();
			reloadAllFeeds();
		} else {
			showstatus("Error fetching FeedList: " + request.status + " " + request.statustext);
		}
	}
}}}
function loadFeeds() {{{
// loads all feeds at startup or upon request
	var navigation=document.getElementById("navigation");

	while (navigation.lastChild){
		navigation.removeChild(navigation.lastChild);
	}
	feedarray = new Array();
	showstatus("Loading Feeds");
	request=ajaxManager();

	request.open("GET", "feeds.php", true);
	request.onreadystatechange = processFeedList;
	request.send(null);
}}}
function processAddDelEditFeed() {{{
// processes addition and deletion of feeds. really just outputs the text from the request
// and calls loadFeeds
	if (request.readyState == 4) {
		if (request.status == 200){
			status=request.responseXML.firstChild;
			alert(status.firstChild.nodeValue);
			loadFeeds();
		}
	}
}}}
function addFeed(){{{
// requests addition of a feed from the server
	request=ajaxManager();

	request.open("GET", "add.php?url="+document.getElementById("addUrl").value+"&name="+document.getElementById("addName").value+"&parentID="+document.getElementById("addDir").value);
	request.onreadystatechange = processAddDelEditFeed;
	request.send(null);
}}}
function removeFeed(i){{{
// requests deletion of a feed from the server
	if (confirm("Really delete Feed?")){
		request=ajaxManager();

		request.open("GET", "del.php?id="+feedarray[i][0]);
		request.onreadystatechange = processAddDelEditFeed;
		request.send(null);
	}
}}}
function getOption(key, def){{{
	var x;
	for (x=0; x<options.length; x++){
		if (options[x][0] == key){
			   return options[x][1];
		}
	}
	x = options.length;
	options[x] = new Object();
	options[x][0] = key;
	options[x][1] = -1;
	showstatus("Loading Option '" + key + "'");
	request=ajaxManager();

	request.open("GET", "getoption.php?key="+key+"&default="+def);
	request.onreadystatechange = getOptionFinal;
	request.send(null);
	return -1;
}}}
function getOptionFinal(){{{
	if (request.readyState == 4) {
		if (request.status == 200){
			var k=request.responseXML.firstChild.firstChild;
			var v=k.nextSibling;
			var x;
			for (x=0; x<options.length; x++){
				if (options[x][0] == k.firstChild.nodeValue){
					options[x][1] = v.firstChild.nodeValue;
				}
			}
		}
	}
}}}
function getOptionArray(){{{
	var o;
	o = getOption(optionarray[0][0], optionarray[0][1]);
	if (o == -1){
		setTimeout("getOptionArray()", 10);
		return;
	}
	optionarray.shift();
	if (optionarray[0]){
		getOptionArray(optionarray);
	} else {
		showstatus("All Options loaded");
		startupprocedure++;
		startup();
	}
}}}
function startup(){{{
	if (startupprocedure == 0){
		optionarray = new Array();
		optionarray[0] = new Object();
		optionarray[0][0] = "showOnlyUnread";
		optionarray[0][1] = true;
		optionarray[1] = new Object();
		optionarray[1][0] = "purgeAfter";
		optionarray[1][1] = "36135";
		getOptionArray(optionarray);
	}
	if (startupprocedure == 1){
		if (getOption("showOnlyUnread", true) == "true"){
			document.getElementById("onlyunread").checked = true;
		} else {
			document.getElementById("onlyunread").checked = false;
		}
		document.getElementById("purgeafter").value = parseInt(getOption("purgeAfter", "36135"));
		resize();
		loadFeeds();
	}
}}}
function showMenuOptions(){{{
	menuOptions = document.getElementById("menuOptions");
	menuOptions.style.left = mouseX-5;
	if (mouseY + menuOptions.offsetHeight > Height){
		menuOptions.style.top = Height - menuOptions.offsetHeight - 5;
	} else {
		menuOptions.style.top = mouseY-5;
	}
	menuOptions.style.zIndex=9999;
	menuOptions.style.visibility='visible';
}}}
function hideMenuOptions(){{{
	menuOptions = document.getElementById("menuOptions");
	menuOptions.style.visibility='collapse';
}}}
function setOptionFinal(){{{
	if (request.readyState == 4) {
		if (request.status == 200){
			var k=request.responseXML.firstChild.firstChild;
			var v=k.nextSibling;
			var x;
			for (x=0; x<options.length; x++){
				if (options[x][0] == k.firstChild.nodeValue){
					options[x][1] = v.firstChild.nodeValue;
					showstatus("Option '" + k.firstChild.nodeValue + "' set to '" + v.firstChild.nodeValue + "'");
				}
			}
		}
	}
}}}
function changeOnlyUnread(){{{
	var key = 'showOnlyUnread';
	var value = document.getElementById("onlyunread").checked;
	showstatus("Setting Option '" + key + "' to '" + value + "'");
	request=ajaxManager();

	request.open("GET", "setoption.php?key="+key+"&value="+value);
	request.onreadystatechange = setOptionFinal;
	request.send(null);
}}}
function changePurgeAfter(){{{
	var key = 'purgeAfter';
	var value = document.getElementById("purgeafter").value;
	showstatus("Setting Option '" + key + "' to '" + value + "'");
	request=ajaxManager();

	request.open("GET", "setoption.php?key="+key+"&value="+value);
	request.onreadystatechange = setOptionFinal;
	request.send(null);
}}}
window.onresize=resize;
window.onmousemove=getMouseCoordinates;
</script>
</head>
<body onLoad="javascript:startup();">
<div id="divSettings" style="position: absolute; left; 0px; top: 0px; background-color: #000000; visibility: hidden;"><div id="divSettingsInner" style="margin: 1px; border: 1px; background-color: #8080FF;"></div></div>
<table class='main' border='0'>
	<tr class='headline'>
		<td colspan='2'>
			<table width='100%' border='0'>
				<tr align='left'>
					<td width='50%' class='headlinewithbackground' valign='top'>
						<div id='options' class='menuouter'><div class='menu'><a href='javascript:showMenuOptions();'>Options</a></div></div>
						<div class='menuouter' id='menuOptions' style='visibility: collapse;position: absolute;'>
							<div class='menu'>
								<table>
									<tr><td><nobr>Show only unread</nobr></td><td><input type='checkbox' id='onlyunread' name='onlyunread' onChange='javascript:changeOnlyUnread();' checked></td><td><a href='javascript:hideMenuOptions();'><img src='process-stop.png' border='0'></a></td></tr>
									<tr><td><nobr>Purge messages after</nobr></td><td><select id='purgeafter' name='purgeafter' onChange='javascript:changePurgeAfter();'><option value='7'>1 Week</option><option value='31'>1 Month</option><option value='180'>6 Months</option><option value='365'>1 Year</option><option value='36135'>99 Years</option></select></td></tr>
								</table>
							</div>
						</div>
					</td>
					<td width='50%' valign='top' align='right' rowspan='2'>
						<nobr><form><input type='text' id='addUrl' value='http://foo/bar.rss'> <input type='text' id='addName' value='Foobar RSS'><select id='addDir'></select><input type='button' value='add feed' onclick="javascript:addFeed();"></form></nobr><br>
						<a href='javascript:reloadAllFeeds();'><img src='view-refresh.png' border='0'></a><br>
					</td>
				</tr>
				<tr>
					<td width='50%' class='headline' align='left'>blindRSS</td>
				</tr>
			</table>
		</td>
	</tr>
	<tr class='subheadline'>
		<td class='subheadline' colspan='2'>blindcoders simple RSS Reader</td>
	</tr>
	<tr class='statusline'>
		<td id='statusline' class='statusline' colspan='2'>Status: </td>
	</tr>
	<tr class='main'>
		<td class='left' valign='top'>
			<div id='subnavigationscrollouter' dir="rtl" style="height: 400px; width:100%; overflow: auto;">
				<div width="100%" dir="ltr">
					<table class='navigation'>
						<tr class='navigation'>
							<td id='navigation' class='navigation'>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</td>
		<td class='right' valign='top'>
			<table class='content'>
				<tr class='content'>
					<td class='content'>
						<div id='subnavigationscrollinner' dir="rtl" style="height:80px; width:100%; overflow: auto;">
							<div width="100%" dir="ltr" id='subnavigation'>
							</div>
						</div>
					</td>
				</tr>
				<tr>
					<td>
						<hr>
					</td>
				</tr>
				<tr class='content'>
					<td class='content'>
						<table>
							<tr>
								<td class='contentheadline'>
									<b><a href='#' id="contentheadline">Welcome to blindRSS</a></b>
								</td>
							</tr>
							<tr>
								<td>
									<div id="contentinner" dir='rtl' style="height:265px; width:100%; overflow: auto;">
										<div width="100%" dir="ltr">
											<table>
												<td id="contentcontent" class='contentcontent'>
													blindRSS is a very simple browser-operated RSS reader.<br>
													You can click through the feeds on the left, use the (hopefully self-explanatory) icons next to them to manipulate them and do all the other stuff a RSS reader should do.<br>
													It's programmed so that the feeds are re-read by a cronjob or daemon and as much functionality as possible is done within the client. Thus the server only does what it is IMO supposed to do: serve data.<br>
													<br>
													Enjoy :-)
												</td>
											</table>
										</div>
									</div>
								</td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</td>
	</tr>
</table>
</body>
</html>
